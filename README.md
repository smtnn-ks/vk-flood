# Тестовое задание

## Что нужно сделать

Реализовать интерфейс с методом для проверки правил флуд-контроля. Если за последние N секунд вызовов метода Check будет больше K, значит, проверка на флуд-контроль не пройдена.

- Интерфейс FloodControl располагается в файле main.go.

- Флуд-контроль может быть запущен на нескольких экземплярах приложения одновременно, поэтому нужно предусмотреть общее хранилище данных. Допустимо использовать любое на ваше усмотрение. 

Хорошо, если добавите поддержку конфигурации итоговой реализации. Параметры — на ваше усмотрение.

## Как решал 

Поскольку для данного функционала важна скорость работы и не столь важна
целостность данных, я решил использовать [redis](https://redis.io/) в качестве 
общего хранилища. 

Логика следующая: в redis храним по ID пользователя количество его соединений.
Эта запись удаляется через N секунд. При подключении увеличиваем это значение на
единицу и обновляем таймер. Если оно больше K, то проверка не пройдена.

Redis позволяет увеличивать неустановленные записи. Redis создаст запись со
значением 0 и увеличит его. 

Осталось выбрать как обращаться к базе. Было три основных варианта:

- Напрямую 
- Pipeline
- Транзакция

В итоге я выбрал pipeline, поскольку оно самое быстрое и меньше падало при большом
количестве соединений.

## Конфиг

Для конфигурации флуд-контроля реализован тип `FCConfig`. В нем можно установить свойства `MaxRequest` и `BanWindow`.

## Результат 

Ниже приведены результаты синтетического теста на большое количество запросов. 

|Процессы|Кол-во запросов|Затраченное время (секунды)|Запросов в секунду|
|---|---|---|---|
|1|100000|2.9|34482|
|2|200000|5.4|37037|
|3|300000|8.6|34883|
|4|400000|12.6|31746|

Получается, что использовать несколько процессов можно, но прироста
производительности это не принесет. 

## Как запустить? 

1. Запускаем redis в docker:

```console
$ docker run --name some-redis -p 6379:6379 -d redis redis-server --save 60 1 --loglevel warning
```

2. Запускаем приложение

```console
$ REDIS_URL=localhost:6379 go run main.go 
```
